<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #e3e0db; color: #444; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        .sidebar-item { transition: all 0.2s; cursor: pointer; opacity: 0.6; display: flex; flex-direction: column; align-items: center; padding: 10px 0; width: 100%; }
        .sidebar-item:hover { opacity: 1; background: rgba(255,255,255,0.05); }
        .active-tab { opacity: 1; background: rgba(255,255,255,0.1); border-radius: 12px; }
        
        textarea, input[type="text"] { background: transparent; border: none; outline: none; width: 100%; resize: none; transition: 0.3s; }
        textarea:focus, input[type="text"]:focus { background: rgba(0,0,0,0.02); border-radius: 8px; padding: 4px; }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }
        .day-card { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border: 0.5px solid #f0f0f0; cursor: pointer; transition: 0.2s; position: relative; }
        .day-card:hover { background-color: #f9f9f9; }
        .today { background: #333; color: white; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; }
        
        /* CAMBIO AQU√ç: Puntito m√°s grande y color beige oscuro */
        .has-content::after { content: ''; position: absolute; bottom: 6px; width: 6px; height: 6px; background: #8a817c; border-radius: 50%; }

        /* Iconos de Bienestar */
        .wellness-icon { cursor: pointer; transition: transform 0.1s ease-in-out; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .wellness-icon:active { transform: scale(0.9); }
        .wellness-label { font-size: 8px; margin-top: 2px; font-weight: bold; }
        
        .custom-checkbox { accent-color: #333; transform: scale(1.2); cursor: pointer; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-6xl bg-[#fcfcfc] rounded-[2.5rem] shadow-2xl flex min-h-[750px] overflow-hidden border border-stone-200">
        
        <nav class="w-24 bg-[#1a1a1a] flex flex-col items-center py-6 justify-between text-white overflow-y-auto custom-scrollbar">
            <div class="flex flex-col items-center gap-4 w-full px-2">
                <div class="w-14 h-14 bg-[#333] rounded-full flex items-center justify-center font-bold text-sm tracking-widest border border-stone-600 shadow-lg mb-2">THI</div>
                
                <div onclick="showTab('mes')" id="nav-mes" class="sidebar-item active-tab">
                    <span class="text-xl">üìÖ</span><span class="text-[9px] font-bold tracking-widest mt-1">MES</span>
                </div>
                <div onclick="showTab('dia')" id="nav-dia" class="sidebar-item">
                    <span class="text-xl">üìù</span><span class="text-[9px] font-bold tracking-widest mt-1">D√çA</span>
                </div>
                <div onclick="showTab('luces')" id="nav-luces" class="sidebar-item">
                    <span class="text-xl">‚ú®</span><span class="text-[9px] font-bold tracking-widest mt-1">LUCES</span>
                </div>
                <div onclick="showTab('oracion')" id="nav-oracion" class="sidebar-item">
                    <span class="text-xl">üôè</span><span class="text-[9px] font-bold tracking-widest mt-1">ORACI√ìN</span>
                </div>
                <div onclick="showTab('bienestar')" id="nav-bienestar" class="sidebar-item">
                    <span class="text-xl">üåø</span><span class="text-[9px] font-bold tracking-widest mt-1">BIENESTAR</span>
                </div>
                <div onclick="showTab('notas')" id="nav-notas" class="sidebar-item">
                    <span class="text-xl">üìñ</span><span class="text-[9px] font-bold tracking-widest mt-1">NOTAS</span>
                </div>
            </div>
            
            <a href="https://calendar.google.com" target="_blank" class="opacity-30 hover:opacity-100 transition-opacity mb-4">
                <span class="text-xl">üîó</span>
            </a>
        </nav>

        <main class="flex-1 p-8 overflow-y-auto bg-[#faf9f6]" id="main-scroll">
            <div id="view-container"></div>
        </main>
    </div>

    <footer class="mt-4 text-stone-500 text-[10px] tracking-[0.2em] uppercase">
        Digital Planner by <span class="font-bold">The Holy Item</span> ¬©
    </footer>

    <script>
        // --- CONFIGURACI√ìN ---
        let viewDate = new Date();
        let selectedDate = new Date();
        const months = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

        // --- MANEJO DE DATOS ---
        function getDayData(date) {
            const key = `day-${date.toISOString().split('T')[0]}`;
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : { 
                tasks: "", 
                luces: [], 
                examen: ["", "", "", "", ""], 
                wellness: { sleep: 0, water: 0, mobility: 0, nature: 0 },
                prayer: { checks: [], message: "" }
            };
        }

        function saveDayData(date, data) {
            const key = `day-${date.toISOString().split('T')[0]}`;
            localStorage.setItem(key, JSON.stringify(data));
        }

        // --- VISTAS ---
        function showTab(tab) {
            const container = document.getElementById('view-container');
            document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active-tab'));
            const navId = tab === 'dia' ? 'dia' : tab; 
            const navEl = document.getElementById('nav-' + navId);
            if(navEl) navEl.classList.add('active-tab');

            document.getElementById('main-scroll').scrollTop = 0;

            if (tab === 'mes') renderMonthView(container);
            else if (tab === 'dia') renderDayView(container);
            else if (tab === 'luces') renderLucesView(container);
            else if (tab === 'oracion') renderPrayerGlobalView(container);
            else if (tab === 'bienestar') renderWellnessGlobalView(container);
            else renderNotesView(container);
        }

        function renderMonthView(container) {
            const monthName = months[viewDate.getMonth()];
            container.innerHTML = `
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-4xl text-stone-800">${monthName} <span class="text-stone-300">${viewDate.getFullYear()}</span></h2>
                    <div class="flex gap-4 text-2xl text-stone-400">
                        <button onclick="changeMonth(-1)">‚Äπ</button><button onclick="changeMonth(1)">‚Ä∫</button>
                    </div>
                </div>
                <div class="grid grid-cols-7 mb-2 text-xs font-bold text-stone-400 tracking-widest text-center">
                    <div>DOM</div><div>LUN</div><div>MAR</div><div>MI√â</div><div>JUE</div><div>VIE</div><div>S√ÅB</div>
                </div>
                <div class="calendar-grid bg-white rounded-2xl shadow-sm overflow-hidden border border-stone-100">
                    ${generateCalendarHtml()}
                </div>
            `;
        }

        function renderDayView(container) {
            const data = getDayData(selectedDate);
            const dateStr = `${selectedDate.getDate()} de ${months[selectedDate.getMonth()]}`;

            container.innerHTML = `
                <div class="flex items-center gap-4 mb-6">
                    <button onclick="showTab('mes')" class="text-stone-300 hover:text-stone-800 text-xl">‚Üê</button>
                    <h2 class="text-3xl text-stone-800 italic">${dateStr}</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div class="bg-white p-6 rounded-3xl shadow-sm border border-stone-100">
                            <h3 class="text-sm font-bold text-stone-400 tracking-widest uppercase mb-4">Pendientes</h3>
                            <textarea oninput="updateField('tasks', this.value)" class="w-full h-40 text-stone-600 leading-relaxed" placeholder="- Tarea importante...">${data.tasks}</textarea>
                        </div>

                        <div class="bg-[#fffbf0] p-6 rounded-3xl shadow-sm border border-stone-100 relative overflow-hidden">
                            <div class="absolute top-0 right-0 p-4 opacity-10 text-4xl">‚ú®</div>
                            <h3 class="text-sm font-bold text-yellow-600 tracking-widest uppercase mb-4">Luces del d√≠a ‚ú®</h3>
                            <textarea oninput="updateLuces(this.value)" class="w-full h-32 text-stone-700 italic" placeholder="¬øQu√© peque√±o milagro sucedi√≥ hoy?">${data.luces.join('\n')}</textarea>
                        </div>

                        <div class="bg-white p-6 rounded-3xl shadow-sm border border-stone-100">
                            <h3 class="text-sm font-bold text-stone-400 tracking-widest uppercase mb-6">Bienestar</h3>
                            
                            <div class="mb-4">
                                <div class="flex items-center gap-2 mb-2"><span class="text-lg">üåô</span> <span class="text-xs font-bold text-stone-500">SUE√ëO (Horas)</span></div>
                                <div id="wellness-sleep" class="flex gap-2 flex-wrap">${generateIcons('sleep', 8, '1HR', data.wellness.sleep, 'text-indigo-400')}</div>
                            </div>
                            
                            <div class="mb-4">
                                <div class="flex items-center gap-2 mb-2"><span class="text-lg">üíß</span> <span class="text-xs font-bold text-stone-500">HIDRATACI√ìN (Vasos)</span></div>
                                <div id="wellness-water" class="flex gap-2 flex-wrap">${generateIcons('water', 8, '250mL', data.wellness.water, 'text-blue-400')}</div>
                            </div>

                            <div class="mb-4">
                                <div class="flex items-center gap-2 mb-2"><span class="text-lg">ü¶∂</span> <span class="text-xs font-bold text-stone-500">MOVILIDAD (Bloques 20m)</span></div>
                                <div id="wellness-mobility" class="flex gap-4">${generateIcons('mobility', 3, '20min', data.wellness.mobility, 'text-orange-400')}</div>
                            </div>

                            <div>
                                <div class="flex items-center gap-2 mb-2"><span class="text-lg">üåø</span> <span class="text-xs font-bold text-stone-500">NATURALEZA (Bloques 10m)</span></div>
                                <div id="wellness-nature" class="flex gap-4">${generateIcons('nature', 3, '10min', data.wellness.nature, 'text-green-500')}</div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-white p-6 rounded-3xl shadow-sm border border-stone-100">
                            <h3 class="text-sm font-bold text-stone-400 tracking-widest uppercase mb-4">Examen de Conciencia</h3>
                            ${renderExamenInputs(data.examen)}
                        </div>

                        <div class="bg-stone-800 p-6 rounded-3xl shadow-sm border border-stone-700 text-stone-200">
                            <h3 class="text-sm font-bold text-stone-400 tracking-widest uppercase mb-4">Vida de Oraci√≥n</h3>
                            <p class="text-xs leading-relaxed text-stone-400 mb-6 italic">"La oraci√≥n es la conversaci√≥n que sostenemos con Dios todos los d√≠as: en medio de actividades, triunfos y ca√≠das. Una uni√≥n real, personal y constante."</p>
                            
                            <p class="font-bold text-sm mb-3">¬øC√≥mo escuch√© y habl√© con Dios hoy?</p>
                            <div class="grid grid-cols-1 gap-2 text-sm text-stone-300 mb-6">
                                ${renderPrayerChecklist(data.prayer.checks)}
                            </div>

                            <p class="font-bold text-sm mb-2">¬øQu√© me dijo Dios hoy?</p>
                            <textarea oninput="updatePrayerMsg(this.value)" class="w-full h-24 bg-stone-700/50 rounded-xl p-3 text-stone-200 text-sm" placeholder="Gu√°rdalo en el coraz√≥n...">${data.prayer.message}</textarea>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLucesView(container) {
            const allKeys = Object.keys(localStorage).filter(k => k.startsWith('day-')).sort().reverse();
            let html = `<h2 class="text-4xl text-stone-800 mb-2">Mis Luces ‚ú®</h2>
                        <p class="text-stone-400 mb-8">Peque√±os destellos de Dios en mi vida.</p>
                        <div class="columns-1 md:columns-2 gap-6 space-y-6">`;
            
            if (allKeys.length === 0) html += `<p class="italic text-stone-400">A√∫n no hay luces registradas.</p>`;

            allKeys.forEach(key => {
                const data = JSON.parse(localStorage.getItem(key));
                if (data.luces && data.luces.length > 0 && data.luces[0] !== "") {
                    const dateParts = key.replace('day-', '').split('-');
                    const dateDisplay = `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
                    
                    html += `
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-yellow-100 break-inside-avoid">
                            <div class="text-[10px] font-bold text-yellow-600 mb-2">${dateDisplay}</div>
                            <p class="text-stone-600 italic font-serif text-lg leading-relaxed">"${data.luces.join(' ')}"</p>
                        </div>
                    `;
                }
            });
            html += `</div>`;
            container.innerHTML = html;
        }

        function renderPrayerGlobalView(container) {
             const allKeys = Object.keys(localStorage).filter(k => k.startsWith('day-')).sort().reverse();
             let html = `<h2 class="text-4xl text-stone-800 mb-2">Diario Espiritual üôè</h2>
                         <p class="text-stone-400 mb-8">Mi historia de salvaci√≥n personal.</p>
                         <div class="space-y-6 max-w-3xl">`;

             allKeys.forEach(key => {
                const data = JSON.parse(localStorage.getItem(key));
                if (data.prayer && data.prayer.message) {
                    const dateParts = key.replace('day-', '').split('-');
                    const dateDisplay = `${dateParts[2]} ${months[parseInt(dateParts[1])-1]} ${dateParts[0]}`;
                    
                    html += `
                        <div class="bg-white p-8 rounded-3xl shadow-sm border border-stone-100 relative">
                            <div class="absolute top-6 right-8 text-xs font-bold text-stone-300 uppercase">${dateDisplay}</div>
                            <h4 class="font-serif text-xl text-stone-800 mb-4">Lo que Dios me dijo:</h4>
                            <p class="text-stone-600 leading-relaxed">${data.prayer.message}</p>
                            ${data.prayer.checks.length > 0 ? `<div class="mt-4 pt-4 border-t border-stone-100 text-xs text-stone-400">Medios: ${data.prayer.checks.join(', ')}</div>` : ''}
                        </div>
                    `;
                }
             });
             container.innerHTML = html;
        }

        function renderWellnessGlobalView(container) {
            const allKeys = Object.keys(localStorage).filter(k => k.startsWith('day-'));
            let totalDays = 0;
            let totals = { sleep: 0, water: 0, mobility: 0, nature: 0 };
            const maxPoints = { sleep: 8, water: 8, mobility: 3, nature: 3 };

            allKeys.forEach(key => {
                const data = JSON.parse(localStorage.getItem(key));
                if (data.wellness) {
                    if(data.wellness.sleep > 0 || data.wellness.water > 0 || data.wellness.mobility > 0 || data.wellness.nature > 0) {
                        totalDays++;
                        totals.sleep += (data.wellness.sleep || 0);
                        totals.water += (data.wellness.water || 0);
                        totals.mobility += (data.wellness.mobility || 0);
                        totals.nature += (data.wellness.nature || 0);
                    }
                }
            });

            if (totalDays === 0) totalDays = 1;

            const scores = {
                sleep: Math.round((totals.sleep / (totalDays * maxPoints.sleep)) * 100),
                water: Math.round((totals.water / (totalDays * maxPoints.water)) * 100),
                mobility: Math.round((totals.mobility / (totalDays * maxPoints.mobility)) * 100),
                nature: Math.round((totals.nature / (totalDays * maxPoints.nature)) * 100)
            };

            const introText = "Estamos llamados a vivir una armon√≠a de amor propio: a cuidarnos con prudencia, sabiendo que Dios nos asiste y nos acompa√±a incluso en lo m√°s humano y corporal.";

            container.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-4xl text-stone-800 mb-6">Mi Bienestar üåø</h2>
                    <p class="text-lg text-stone-500 italic font-serif mb-10 leading-relaxed bg-white p-6 rounded-2xl border border-stone-100 shadow-sm">
                        "${introText}"
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                        ${renderScoreCard('Sue√±o', scores.sleep, 'üåô', "Quiz√°s esta semana podr√≠as irte a dormir m√°s temprano, prioriza tu descanso. ¬°√Ånimo!")}
                        ${renderScoreCard('Hidrataci√≥n', scores.water, 'üíß', "Te reto a llevarte tu termo de agua a todos lados durante esta semana.")}
                        ${renderScoreCard('Movilidad', scores.mobility, 'ü¶∂', "Qu√© te parece si esta semana cada 4 horas te propones caminar 10 minutos, aunque sea dentro de un edificio.")}
                        ${renderScoreCard('Naturaleza', scores.nature, 'üåø', "Estar en contacto con la naturaleza tambi√©n es un tema de atenci√≥n. ¬øQu√© te parece si est√° semana admiras conscientemente la creaci√≥n que te rodea?")}
                    </div>
                </div>
            `;
        }

        function renderScoreCard(title, score, icon, feedback) {
            let color = score > 70 ? 'bg-green-100 text-green-700' : (score > 40 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-50 text-red-700');
            let showFeedback = score < 60; 

            return `
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-stone-100">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${icon}</span>
                            <h3 class="font-bold text-stone-600 uppercase tracking-widest text-sm">${title}</h3>
                        </div>
                        <span class="text-2xl font-bold text-stone-800">${score}%</span>
                    </div>
                    
                    <div class="w-full bg-stone-100 rounded-full h-2 mb-4 overflow-hidden">
                        <div class="h-full bg-stone-800" style="width: ${score}%"></div>
                    </div>

                    ${showFeedback ? `
                        <div class="mt-4 p-4 ${color} rounded-xl text-sm italic leading-relaxed">
                            ${feedback}
                        </div>
                    ` : `<div class="mt-4 text-xs text-stone-400 text-center">¬°Vas muy bien! Mant√©n el ritmo.</div>`}
                </div>
            `;
        }

        function renderNotesView(container) {
             const saved = localStorage.getItem('global-notes') || "";
             // CAMBIO AQU√ç: T√≠tulo actualizado
             container.innerHTML = `
                <h2 class="text-4xl text-stone-800 mb-6">Notas generales üìñ</h2>
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-stone-100 min-h-[500px]">
                    <textarea oninput="localStorage.setItem('global-notes', this.value)" 
                        class="w-full h-full text-lg text-stone-600 leading-relaxed"
                        placeholder="Escribe aqu√≠ ideas, proyectos o pensamientos que no dependan de una fecha...">${saved}</textarea>
                </div>
            `;
        }

        // --- COMPONENTES ---

        function generateIcons(type, max, label, currentVal, activeColorClass) {
            let html = '';
            const iconsMap = { sleep: 'üåô', water: 'üíß', mobility: 'ü¶∂', nature: 'üåø' };
            const iconChar = iconsMap[type];

            const bgActive = activeColorClass.replace('text', 'bg').replace('400', '100').replace('500', '100');
            
            for(let i=1; i<=max; i++) {
                const isActive = i <= currentVal;
                const bgClass = isActive ? bgActive : 'bg-stone-50';
                const textClass = isActive ? activeColorClass : 'text-stone-300';
                const labelClass = isActive ? 'text-stone-600' : 'text-stone-300';
                const opacity = isActive ? 'opacity-100 filter-none' : 'opacity-40 grayscale';

                html += `
                    <div onclick="updateWellness('${type}', ${i})" class="wellness-icon group ${opacity}">
                         <div class="w-8 h-8 rounded-full border border-stone-200 flex items-center justify-center ${bgClass}">
                            <span class="text-lg ${textClass}">${iconChar}</span>
                         </div>
                         <span class="wellness-label ${labelClass}">${label}</span>
                    </div>
                `;
            }
            return html;
        }

        function renderExamenInputs(values) {
            const questions = [
                "¬øQu√© es lo que m√°s agradezco de hoy?",
                "¬øEn qu√© lugares, situaciones o personas vi a Dios el d√≠a de hoy?",
                "¬øQu√© emoci√≥n predomin√≥ hoy? (H√°blalo con Dios)",
                "¬øDesde qu√© lugar interior me gustar√≠a vivir ma√±ana?",
                "¬øEn qu√© momentos me qued√© corta en amor? (Pide un coraz√≥n como el Suyo)"
            ];
            
            return questions.map((q, idx) => `
                <div class="mb-4">
                    <label class="block text-xs font-bold text-stone-500 mb-2 leading-tight">${q}</label>
                    <textarea oninput="updateExamen(${idx}, this.value)" class="w-full h-16 bg-stone-50 rounded-xl p-3 text-sm text-stone-700 focus:bg-white border border-transparent focus:border-stone-200" placeholder="Escribe aqu√≠...">${values[idx] || ''}</textarea>
                </div>
            `).join('');
        }

        function renderPrayerChecklist(checkedItems) {
            const options = ["Meditaci√≥n de la palabra", "Contemplaci√≥n en el sant√≠simo", "Contemplaci√≥n en la naturaleza", "Conversaci√≥n en el coche", "Oraci√≥n de repetici√≥n", "Lectura espiritual", "Otro"];
            
            return options.map(opt => {
                const isChecked = checkedItems.includes(opt);
                return `
                    <label class="flex items-center gap-3 cursor-pointer hover:text-white transition-colors">
                        <input type="checkbox" class="custom-checkbox w-4 h-4 bg-transparent border-stone-500 rounded" 
                            ${isChecked ? 'checked' : ''} 
                            onchange="togglePrayerCheck('${opt}')">
                        <span>${opt}</span>
                    </label>
                `;
            }).join('');
        }

        // --- ACTUALIZACI√ìN OPTIMIZADA ---

        function updateWellness(type, val) {
            const data = getDayData(selectedDate);
            const newValue = (data.wellness[type] === val) ? 0 : val;
            data.wellness[type] = newValue;
            saveDayData(selectedDate, data);

            const container = document.getElementById(`wellness-${type}`);
            const icons = container.children;
            
            const colorMap = {
                'sleep': { text: 'text-indigo-400', bg: 'bg-indigo-100' },
                'water': { text: 'text-blue-400', bg: 'bg-blue-100' },
                'mobility': { text: 'text-orange-400', bg: 'bg-orange-100' },
                'nature': { text: 'text-green-500', bg: 'bg-green-100' }
            };
            const styles = colorMap[type];

            for (let i = 0; i < icons.length; i++) {
                const iconDiv = icons[i];
                const circle = iconDiv.querySelector('div');
                const iconSpan = circle.querySelector('span');
                const labelSpan = iconDiv.querySelector('.wellness-label');
                const indexVal = i + 1;

                if (indexVal <= newValue) {
                    iconDiv.classList.remove('opacity-40', 'grayscale');
                    iconDiv.classList.add('opacity-100', 'filter-none');
                    circle.className = `w-8 h-8 rounded-full border border-stone-200 flex items-center justify-center ${styles.bg}`;
                    iconSpan.className = `text-lg ${styles.text}`;
                    labelSpan.className = "wellness-label text-stone-600";
                } else {
                    iconDiv.classList.add('opacity-40', 'grayscale');
                    iconDiv.classList.remove('opacity-100', 'filter-none');
                    circle.className = "w-8 h-8 rounded-full border border-stone-200 flex items-center justify-center bg-stone-50";
                    iconSpan.className = "text-lg text-stone-300";
                    labelSpan.className = "wellness-label text-stone-300";
                }
            }
        }

        function updateField(field, value) {
            const data = getDayData(selectedDate);
            data[field] = value;
            saveDayData(selectedDate, data);
        }

        function updateLuces(value) {
            const data = getDayData(selectedDate);
            data.luces = [value]; 
            saveDayData(selectedDate, data);
        }

        function updateExamen(idx, value) {
            const data = getDayData(selectedDate);
            data.examen[idx] = value;
            saveDayData(selectedDate, data);
        }

        function togglePrayerCheck(option) {
            const data = getDayData(selectedDate);
            const idx = data.prayer.checks.indexOf(option);
            if (idx > -1) data.prayer.checks.splice(idx, 1);
            else data.prayer.checks.push(option);
            saveDayData(selectedDate, data);
        }

        function updatePrayerMsg(val) {
            const data = getDayData(selectedDate);
            data.prayer.message = val;
            saveDayData(selectedDate, data);
        }

        // --- CALENDARIO ---
        function generateCalendarHtml() {
            let html = '';
            const year = viewDate.getFullYear();
            const month = viewDate.getMonth();
            const firstDayIndex = new Date(year, month, 1).getDay();
            const lastDay = new Date(year, month + 1, 0).getDate();
            const prevLastDay = new Date(year, month, 0).getDate();

            for (let x = firstDayIndex; x > 0; x--) {
                html += `<div class="day-card text-stone-200 bg-stone-50/50">${prevLastDay - x + 1}</div>`;
            }

            for (let i = 1; i <= lastDay; i++) {
                const d = new Date(year, month, i);
                const key = `day-${d.toISOString().split('T')[0]}`;
                const data = localStorage.getItem(key);
                let hasContent = false;
                if(data) {
                    const p = JSON.parse(data);
                    if(p.tasks || (p.luces && p.luces.length && p.luces[0]) || p.prayer.message) hasContent = true;
                }

                const isToday = new Date().toDateString() === d.toDateString();
                const isSelected = selectedDate.toDateString() === d.toDateString();

                html += `
                    <div onclick="selectDate(${year}, ${month}, ${i})" 
                         class="day-card text-stone-500 font-medium ${hasContent ? 'has-content' : ''} ${isSelected ? 'bg-stone-100 ring-2 ring-stone-200' : ''}">
                        <span class="${isToday ? 'today' : ''}">${i}</span>
                    </div>`;
            }
            return html;
        }

        function changeMonth(offset) {
            viewDate.setMonth(viewDate.getMonth() + offset);
            showTab('mes');
        }

        function selectDate(y, m, d) {
            selectedDate = new Date(y, m, d);
            showTab('dia');
        }

        showTab('mes');
    </script>
</body>
</html>
